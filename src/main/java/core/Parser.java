package core;

import org.jsoup.*;
import org.jsoup.nodes.*;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;


public class Parser {
    private int pagesToSearch;
    public Parser(int pages) {
        this.pagesToSearch = pages + 1;
    }

    public enum DATA {
        TITLES, PLATFORMS, AUTHORS
    }

    private String[] routes = {"/remote", "/webapps", "/local", "/dos", "/shellcode", "/papers"};
    public List<String> Parse(DATA data_t) {
        List<String> all_titles = new ArrayList<String>();
        List<String> all_platforms = new ArrayList<String>();
        List<String> all_authors = new ArrayList<String>();
        try {
            for(int m = 1; m < this.pagesToSearch; m++) {
                for(int i = 0; i < this.routes.length - 1; i++) {
                    Document source = Jsoup.connect("https://www.exploit-db.com" + routes[i] + "/?order_by=date_published&order=desc&pg=" + m).get();
                    List<String> titles =  source.select(".exploit_list tr td").select(".description a").eachText();
                    List<String> platforms =  source.select(".exploit_list tr td").select(".platform a").eachText();
                    List<String> authors =  source.select(".exploit_list tr td").select(".author a").eachText();
                    all_titles.addAll(titles); all_authors.addAll(authors); all_platforms.addAll(platforms);
                    /*
                    ~~ DEBUG ~~
                    for(int x = 0; x < titles.size(); x++) {
                        System.out.printf("\nTitle: %s\nPlatform: %s\nAuthor: %s\nURI: %s\n", titles.get(x), platforms.get(x), author.get(x), "https://www.exploit-db.com" + routes[i] + "/?order_by=date_published&order=desc&pg=" + m);
                    }
                    */
                }
            }
            switch(data_t) {
                case TITLES:
                    return all_titles;
                case PLATFORMS:
                    return all_platforms;
                case AUTHORS:
                    return all_authors;
                default:
                    return null;
            }

        } catch(IOException err) {
            err.printStackTrace();
        }
        return null;
    }
}
